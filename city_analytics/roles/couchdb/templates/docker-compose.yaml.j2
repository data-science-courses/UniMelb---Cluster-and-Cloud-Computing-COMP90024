version: '3.7'

services:
  couchdb:
    image: couchdb
    restart: always
    ports: 
     - 5984:5984
     - 4369:4369
     - 5986:5986
     - 9100-9200:9100-9200
    environment:
      COUCHDB_USER: {{ database_user }} 
      COUCHDB_PASSWORD: {{ database_password }}
      COUCHDB_SECRET: {{ couchdb_secret }}
      NODENAME: {{ ansible_host }}
      ERL_FLAGS: "-setcookie {{cookie}}" 
    volumes:
      - ./{{ lookup('pipe', 'date +%Y%m%d-%H%M') }}/data:/opt/couchdb/data
    